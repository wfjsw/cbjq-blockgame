<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å°˜ç™½ç¦åŒºä¿¡æºç ”æ</title>
  <script src="https://cdn.bootcdn.net/ajax/libs/vue/3.2.47/vue.global.prod.min.js"></script>
  <script src="./calc.js"></script>
</head>

<body>
  <div>
    åŸä½œè€…ï¼š<a href="https://space.bilibili.com/277401945" target="_blank">Bilibili æ–¹å½¢çš„å—çŠ¶ä»£ç </a>
  </div>
  
  <div id="app">
    <div>
      
      <!-- <input type="button" value="æ›´æ–°æ—¥å¿—" @click="confirmBoard"> -->
      <button v-if="cache" @click="changeCacheState(false)">ç¼“å­˜çŠ¶æ€ï¼šå¼€</button>
      <button v-else @click="changeCacheState(true)">ç¼“å­˜çŠ¶æ€ï¼šå…³</button>
      <button style="margin-left: 5px;" @click="changeCacheHelpDialogVisible(true)">â“</button>
      
      <dialog id="cacheHelpDialog" ref="cacheHelpDialog">
        <div id="cacheHelpDialogDiv" style="padding: -20px;">
          <p>ã€æµ‹è¯•æ€§åŠŸèƒ½ã€‘</p>
          <p>é‡åˆ° bug å¯ä»¥å¸¦ä¸Šå‡ºé”™çš„æƒ…å†µäº <a href="https://github.com/halozhy/cbjq" target="_blank">GitHub åˆ†æ”¯ä»“åº“</a> æˆ–  <a href="https://www.bilibili.com/video/BV1hp4y1j75k/" target="_blank">BV1hp4y1j75k</a> åé¦ˆ</p>
          <hr>
          <p>ï¼ˆç‚¹å‡»ç¼“å­˜çŠ¶æ€æŒ‰é’®å³å¯æ”¹å˜ç¼“å­˜çŠ¶æ€ï¼‰</p>
          <p>
            ç¼“å­˜çŠ¶æ€ä¸ºâ€œå¼€â€æ—¶ï¼Œå½“é¡µé¢åˆ·æ–°ï¼Œå…³é—­æˆ–å¯è§æ€§è¢«æ”¹å˜åï¼Œç¨‹åºä¼šå°†<b>é¡µé¢æ•°æ®</b>ä¿å­˜åœ¨æµè§ˆå™¨çš„ LocalStorage ä¸­
          </p>
          <p>
            <b>é¡µé¢æ•°æ®ä¸»è¦åŒ…å«ï¼šæ ¼å­è¡Œåˆ—æ•°æ®ï¼Œå„ä¸ªæ–¹å—ä¸ªæ•°ï¼Œå›æ”¶ä¸ªæ•°ï¼Œä½†ä¸åŒ…å«è®¡ç®—å¾—åˆ°çš„æ–¹æ¡ˆ</b>ï¼ˆå› ä¸ºæ–¹æ¡ˆç§ç±»å¯èƒ½å¾ˆå¤šï¼Œä»¥è‡³äº LocalStorage å­˜ä¸ä¸‹ï¼‰
          </p>
          <p>
            å¦‚æœéœ€è¦æ¸…é™¤ç¼“å­˜æ•°æ®ï¼Œè¯·å°†ç¼“å­˜çŠ¶æ€æ”¹ä¸ºâ€œå…³â€ï¼Œå³å¯æ¸…é™¤
          </p>
        </div>
        <div style="text-align: center;">

          <button  @click="changeCacheHelpDialogVisible(false)">ç¡®è®¤</button>
        </div>
      </dialog>

    </div>
    <p>è¡Œæ•°ï¼š<input type="text" v-model="row" /></p>
    <p>åˆ—æ•°ï¼š<input type="text" v-model="col" /></p>
    <input type="button" value="ç¡®å®š" @click="confirmBoard">
    <p>çº¢è‰²è¡¨ç¤ºéœ€è¦æ‘†æ”¾çš„æ ¼å­ï¼Œç™½è‰²è¡¨ç¤ºè¿™é‡Œæ²¡æœ‰æ ¼å­ï¼Œç‚¹å‡»åˆ‡æ¢</p>
    <div v-for="(r, i) in board" style="height: 32px;">
      <div
        class="box"
        v-for="(c, j) in r"
        @click="tuneBox(i, j)"
        :style="{ 'background-color': c === 0 ? 'white' : 'red' }"
      ></div>
    </div>
    <div v-if="board.length" style="margin-top: 0px;">
        <div style="width:fit-content;">
          <table>
            <tr>
              <th></th>
              <th>
                <div style="margin-left: 0px;">
                  å¿…é€‰
                </div>
              </th>
              <th>
                <div style="margin-left: 0px;">
                  å›æ”¶
                </div>
              </th>
              <th>
                <div style="margin-left: 0px;">
                  å›æ”¶ä¸ªæ•°
                </div>
              </th>
              <th>
                <div style="margin-left: 0px;">
                  å–æ¶ˆå›æ”¶
                </div>
              </th>
            </tr>
            <tr v-for="(b, i) in num">
              <td>
                æ–¹å—{{ i + 1 }}ä¸ªæ•°ï¼š
                <div v-if="i+1 === 9" style="display: inline-block;">
                  {{ num[i] + recycledComponents.length}} = 
                      <input style="width: 100px;"  type="text" v-model.number="num[i]" />
                      + {{ recycledComponents.length }}
                </div>
                <div v-else style="display: inline; float: right;">
                  
                      <input type="text" v-model.number="num[i]" />
  

                </div>
              </td>
              <td style=" zoom: 100%; vertical-align: middle; margin-top: 80px; text-align: center;">
                <input type="checkbox" 
                  style="text-align: left; vertical-align: middle; margin-top: 5px;"
                  v-model="selected[i]" 
                  :title="'ä¿¡æº ' + (i+1) + ' å¿…é€‰'"
                  @click="select(i)"/>
              </td>
              <td>
                <Button type="" @click="recycle(i)">ğŸ—‘ï¸</Button>
              </td>
              <td style="vertical-align: middle; text-align: center;">
                {{ recycledNum[i] }}
              </td>
              <td style="text-align: center;">
                <Button type="" @click="cancelRecycle(i)">ğŸ—‘ï¸-1</Button>
              </td>
            </tr>
          </table>
          
          <div 
          style="margin-top: 5px; 
          margin-bottom: 5px; 
          margin-right: 10px; 
          border: dashed 2px; 
          border-radius: 10px; 
          padding: 5px;
          ">
            <div style="font-size: medium;">
              æ–¹å—9ä¸ªæ•°=ç”¨æˆ·è¾“å…¥ {{ num[8] }} + å›æ”¶å¾—åˆ° {{ recycledComponents.length }} <br>
            </div>
            <div style="margin-top: 7px; margin-bottom: 5px;">
              å›æ”¶çš„æ–¹å—9æ„æˆï¼š
            </div>
            <div v-for="(v, i) in recycledComponents">
              <div style="display:inline-block;" v-for="(v2, j) in recycledComponents[i]">
                æ–¹å— {{v2}},&nbsp; 
              </div>
              <br>
              <hr />
            </div>
          </div>

          <!-- <div
          style="margin-top: 5px; 
          margin-bottom: 5px; 
          margin-right: 10px; 
          border: dashed 2px; 
          border-radius: 10px; 
          padding: 5px;
          ">
            <p>ã€2023-09-24æ³¨ã€‘ç›®å‰å¯¹äºæ–¹å— 10 å’Œ 11 çš„æ”¯æŒä»…ç»è¿‡äº†ç®€å•æµ‹è¯•</p>
            <p>å¦‚æœé‡åˆ°å…³äºæ–¹å— 10 å’Œ 11 çš„ bug å¯ä»¥å¸¦ä¸Šå‡ºé”™çš„æƒ…å†µç»™æˆ‘çš„ <a href="https://github.com/halozhy/cbjq">GitHub åˆ†æ”¯ä»“åº“</a> æ Issue</p>
            <p>ï¼ˆæˆ–è€…åœ¨ <a href="https://www.bilibili.com/video/BV1hp4y1j75k/">BV1hp4y1j75k</a> è¿™ä¸ªè§†é¢‘ä¸‹é¢è¯„è®ºåŒºå¸¦ä¸Šå‡ºé”™çš„æƒ…å†µç•™è¨€ï¼‰</p>
          </div> -->
         
          <div>
            <input type="button" value="è®¡ç®—å®Œç¾æ–¹æ¡ˆ" @click="calc">
            <!-- <input type="button" value="æŒ‰ç…§æ­¤ç»“æœæ‰£é™¤å¯¹åº”æ–¹å—" @click="calcFull" style="margin-left: 10px;" > -->
            <input type="button" style="margin-left: 10px;" value="ä¸€é”®å›æ”¶å¹¶è®¡ç®—" @click="calcFull">
            <input type="button" style="margin-right: 10px; float: right;" value="æ’¤é”€æ‰€æœ‰å›æ”¶" ref="resetRecycleBtn" @click="resetRecycle" disabled>
          </div>
        </div>

      
    </div>
    <div v-if="res !== false">
      <p>æ–¹æ¡ˆæ•°ï¼š{{ res.length }}</p>
      <p>æ–¹æ¡ˆæ•°(filterd)ï¼š{{ selectResult.length }}/{{ res.length }}</p>
    </div>
    <div v-if="res.length">
      <p>å½“å‰å±•ç¤ºæ–¹æ¡ˆï¼š{{ now + 1 }} / {{ res.length }}</p>
      <p>å½“å‰å±•ç¤ºæ–¹æ¡ˆ(filterd)ï¼š{{ now + 1 }} / {{ selectResult.length }}</p>
      <input type="button" value="<-" @click="now -= (now > 0)">
      <input type="button" value="->" @click="now += (now + 1 < selectResult.length)">
      <div v-for="(r, i) in sol" style="height: 32px;">
        <div
          class="box"
          v-for="(c, j) in r"
          :style="{ 'background-color': color[c] }"
        >{{ c }}</div>
      </div>
      <div>
        <input type="button" value="æŒ‰ç…§æ­¤ç»“æœæ‰£é™¤å¯¹åº”æ–¹å—" ref="decreaseBtn" @click="decreaseBlock" >
        <input type="button" value="æ’¤é”€æ­¤æ¬¡æ‰£é™¤" ref="resetDecreaseBtn" style="margin-left: 10px;" @click="resetBlock" disabled>
      </div>
    </div>
    
  </div>
  <script>
    const { createApp } = Vue
    createApp({
      data() {
        return {
          row: 5,
          col: 6,
          board: [],
          // board: [[-1, -1, 0, 0], [-1, -1, -1, -1]],
          num: new Array(11).fill(0),
          // num: [0,2,2,2,2,2,1,1,1,0,0],
          // num: [2,2,2,2,2,2,2,1,0,0,0],
          // num: [1,1,1,2,2,2,2,1,0,0,0],
          // num: [6,1,1,2,2,2,2,1,1,1,1], 
          // num: [2,2,2,2,2,0,0,0,0,0,0], 
          numBackup: new Array(11).fill(0), 
          solBackup: new Array(11).fill(0), 
          recycledNum: new Array(11).fill(0),
          recycledComponents: new Array(0),
          recycledComponentsBackup: new Array(0),
          // isDecreased: false, // è¡¨ç¤ºæœ‰æ²¡æœ‰ç‚¹å‡»è¿‡â€œæŒ‰ç…§æ­¤ç»“æœæ‰£é™¤å¯¹åº”æ–¹å—â€æŒ‰é’®
          selected: new Array(11).fill(false),
          res: false,
          selectResult: false,
          now: 0,
          cache: false,
          canCloseCacheHelpDialog: true,
          color: ['white', '#75C0FF', '#3B66CF', '#78ACC5', '#C8FAFD', '#FDFF00', '#4BFF00', '#FF9800', '#B9B24B', '#FF00AE', '#8A2BE2', '#FF00FF']
        }
      },
      watch: {
        recycledNum:{
          handler(newVal, oldVal) {
            // console.log(newVal);
            
        

          },
          deep: true
        }
        
      },
      methods: {
        confirmBoard() {
          const row = Number(this.row)
          const col = Number(this.col)
          this.board = new Array(row)
          for (let i = 0; i < row; ++i) {
            const r = new Array(col).fill(-1)
            this.board[i] = r
          }
        },
        tuneBox(x, y) {
          if (this.board[x][y] === -1) {
            this.board[x][y] = 0
          } else {
            this.board[x][y] = -1
          }
        },
        calc() {
          let num = Object.assign([], this.num)
          num[8] = this.num[8] + this.recycledComponents.length
          this.res = Solve(this.board, num)
          this.now = 0
          this.filter();

          // await nextTick()
          if (this.res.length > 0) {
            // é‡ç½®æ’¤é”€å‰å¤‡ä»½
            this.solBackup = []
            this.recycledComponentsBackup = []
            // é‡ç½®æ‰£é™¤ç›¸å…³çš„ä¸¤ä¸ªæŒ‰é’®çš„çŠ¶æ€
            if (this.$refs.decreaseBtn != undefined) {
              this.$refs.decreaseBtn.disabled = false
              this.$refs.resetDecreaseBtn.disabled = true
            }
          }
        },
        filter(requiredInfoIds) {
          // console.log('in filter');
          if(!this.res){
            return;
          }

          if(!requiredInfoIds){
            requiredInfoIds = this.selected.map((v,i)=>v?i+1:-1).filter(v => v !== -1);
          } 
          // console.log("filter array:",requiredInfoIds);
          if(requiredInfoIds.length == 0){
            this.selectResult = this.res;
            return;
          }
          this.selectResult = this.res.filter(function(result){
            let temp = [].concat(...result);
            let cnt = 0;
            for(let i=0;i<requiredInfoIds.length;++i){
              if(!temp.includes(requiredInfoIds[i])){
                return false;
              }
            }
            return true;
          });
        },
        select(index) {
          // console.log('select');
          let requiredInfoIds = new Array();
          this.selected.forEach((isSelect, i) => {
            if(isSelect && i!=index || !isSelect && i==index){
              requiredInfoIds.push(i+1);
            }
          });
          this.filter(requiredInfoIds);
        },

        // è¿”å›èƒ½å¤Ÿå›æ”¶åˆ°çš„æœ€å¤šçš„9å·æ–­ç‰‡çš„å›æ”¶æ–¹æ¡ˆ
        find9Max(recycledNum) {
          // å…¶å®å°±æ˜¯æ‰¾å‡ºæ‰€æœ‰çš„å›æ”¶æ–¹æ¡ˆï¼Œä¹‹åä»é‡Œé¢æ‰¾ä¸€ä¸ªæœ€é•¿çš„
          let allPathArr = this.find9All(recycledNum);
          let max = 0
          let maxPathArr = [];
          allPathArr.forEach(onePath => {
            if (onePath.length > max) {
              max = onePath.length;
              maxPathArr = onePath;
            }
          });
          return maxPathArr; 
        },

        // è¿”å›æ‰€æœ‰9å·æ–­ç‰‡çš„å›æ”¶æ–¹æ¡ˆ
        find9All(recycledNum) {
          let num = Object.assign([], recycledNum);
          let allPathArr = [];

          // è®¡ç®—ç»„åˆæ•° C(9,5) ç»“æœåº”è¯¥æ˜¯å›ºå®šçš„126ç§å¯èƒ½
          let chooseResult = choose(Array.from({length:9}, (v,k) => k), 5);
          // https://juejin.cn/post/6959102042279247909
          function choose(arr, size) {
            var allResult = [];
            (function (arr, size, result) {
                var arrLen = arr.length;
                if (size > arrLen) {
                    return;
                }
                if (size == arrLen) {
                    allResult.push([].concat(result, arr))
                } else {
                    for (var i = 0; i < arrLen; i++) {
                        var newResult = [].concat(result);
                        newResult.push(arr[i]);

                        if (size == 1) {
                            allResult.push(newResult);
                        } else {
                            var newArr = [].concat(arr);
                            newArr.splice(0, i + 1);
                            arguments.callee(newArr, size - 1, newResult);
                        }
                    }
                }
            })(arr, size, []);
            return allResult;
          }
          
          // é€’å½’æŸ¥æ‰¾  
          recursionFind(num, [], 0);

          /**
           * è¿›è¡Œé€’å½’å‡‘æ•°æŸ¥æ‰¾9å·ç¢ç‰‡çš„å‡½æ•°
           * @param {*} nowRecycleNum å¯å›æ”¶çš„numæ•°ç»„
           * @param {*} pathArr è®°å½•äº†å›æ”¶ç»“æœçš„æ•°ç»„ï¼Œä¹Ÿç›¸å½“äºæ˜¯é€’å½’è·¯å¾„
           * @param {*} layer é€’å½’å±‚æ•°
           */
          function recursionFind(nowRecycleNum, pathArr, layer) {
            layer++;
            let okResultList = [];
            for (let i = 0; i < chooseResult.length; i++) {
              const result = chooseResult[i];
              // console.log(result);
              let flag = true;
              for (let j = 0; j < result.length; j++) {
                const index = result[j];
                if (nowRecycleNum[index] <= 0 ) {
                  // console.log('å­˜åœ¨0ï¼Œæ— æ³•å›æ”¶');
                  flag = false;
                  break;
                }
              }
              if (flag) {
                // è®°å½•ä¸‹æ¥èƒ½å›æ”¶çš„å¯èƒ½æ€§
                okResultList.push(result);
                // break;
              }
            }
            // console.log('è¿™å±‚çš„æ‰€æœ‰æ–¹æ¡ˆæ•°é‡', layer, okResultList.length);
            if (okResultList.length == 0) {
              // è¿™å±‚å·²ç»æ‰¾ä¸åˆ°æ–¹æ¡ˆäº†ï¼Œå› æ­¤returnç»“æŸæ­¤å±‚é€’å½’
              return;
            }
            else {
              // è¿™å±‚ä»æœ‰æ–¹æ¡ˆï¼Œåˆ™è®°å½•åœ¨allPathArré‡Œé¢
              for (let index = 0; index < okResultList.length; index++) {
                const thisPath = okResultList[index];
                // let newOne = [pathArr , thisPath];
                let newOne = [].concat(pathArr);
                newOne.push(thisPath);
                allPathArr.push(newOne)  
              }
              // console.log(allPathArr);
            }
            // console.log('okResultList', layer, okResultList, pathArr);
            for (let i = 0; i < okResultList.length; i++) {
              const okResult = okResultList[i];
              // æŒ‰ç…§æ–¹æ¡ˆå¯¹nowRecycleNumæ‰§è¡Œåˆ å‡
              let nRN = [].concat(nowRecycleNum);
              okResult.forEach(index => {
                nRN[index]--;
              });
              let pa = JSON.parse(JSON.stringify(pathArr));
              pa.push(okResult)
              recursionFind(nRN, pa, layer);
            }
          }
          
          return allPathArr;
        },

        calcFull() {
          // ä¸€é”®å›æ”¶å¹¶è®¡ç®—
          // å…ˆå°è¯•ä¸å›æ”¶ï¼Œç›´æ¥è®¡ç®—ï¼Œå¦‚æœèƒ½å‡ºç»“æœå°±ä¸è¿›è¡Œå›æ”¶
          // å¦‚æœä¸èƒ½å‡ºç»“æœï¼Œè®¡ç®—å‡ºæ‰€æœ‰çš„9å·å›æ”¶æ–¹æ¡ˆï¼Œä¾æ¬¡å°è¯•ï¼Œç›´åˆ°å‡ºç»“æœä¸ºæ­¢
          // å¦‚æœå‡å°è¯•è¿‡äº†ï¼Œä½†æ²¡ç»“æœï¼Œåˆ™è®¤ä¸ºæ— è§£
         
          // å…ˆå°è¯•ä¸å›æ”¶ï¼Œç›´æ¥è®¡ç®—ï¼Œè‹¥æœ‰ç»“æœï¼Œç›´æ¥returnç»“æŸ
          this.calc();
          if (this.selectResult.length > 0 ) {
            return;
          } 
          else {
            // å¦‚æœä¸èƒ½ç›´æ¥å‡ºç»“æœï¼Œè®¡ç®—å‡ºæ‰€æœ‰çš„9å·å›æ”¶æ–¹æ¡ˆ
            let allPathArr = this.find9All(this.num);
            // ä¾æ¬¡å°è¯•ï¼Œç›´åˆ°calcè®¡ç®—åæœ‰ç»“æœä¸ºæ­¢
            for (let index = 0; index < allPathArr.length; index++) {
              const onePath = allPathArr[index];
              // æŒ‰ç…§è¿™ä¸ªæ–¹æ¡ˆè¿›è¡Œå›æ”¶
              for (let j = 0; j < onePath.length; j++) {
                const one9 = onePath[j];
                one9.forEach(index => {
                  // æ‰§è¡Œnum--å’Œrecycle++
                  this.num[index]--;
                  this.recycledNum[index]++;
                });
                // å¯¹ç•Œé¢ä¸Šçš„å›æ”¶åŒºè¿›è¡Œæ›´æ–°
                let one9ForView = one9.map((i)=>(i+1));
                this.recycledComponents.push(one9ForView);
              }
              
              // æ‰§è¡Œcalcè®¡ç®—ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ç»“æœ
              this.calc();
              if (this.selectResult.length > 0 ) {
                // æœ‰ç»“æœäº†ï¼Œreturnç»“æŸ
                return;
              } 
              else {
                // æ— ç»“æœï¼Œæ¢å¤numï¼ŒrecycleNumï¼ŒrecycledComponents
                for (let j = 0; j < onePath.length; j++) {
                  const one9 = onePath[j];
                  one9.forEach(index => {
                    // æ‰§è¡Œnum++å’Œrecycle--
                    this.num[index]++;
                    this.recycledNum[index]--;
                  });
                }
                this.recycledComponents = [];
              }
            }
          }
        },

        // resetRecycle() {
        //   for (let index = 0; index < this.recycledNum.length; index++) {
        //     const value = this.recycledNum[index];
        //     while (this.recycledNum[index] > 0 ){
        //       this.cancelRecycle(index)
        //     }
        //   }
        //   this.calc()
        // },

        // æ’¤é”€æ‰€æœ‰å›æ”¶
        resetRecycle(){
          for (let index = 0; index < this.recycledNum.length; index++) {
            const value = this.recycledNum[index];
            if (this.recycledNum[index] > 0 ){
              this.num[index] = this.num[index] + this.recycledNum[index];
              this.recycledNum[index] = 0;
            }
          }
          this.recycledComponents = []
          // this.calc()
        },

        // å¯¹indexå·æ–¹å—è¿›è¡Œå›æ”¶
        recycle(index) {
          if (this.num[index] > 0 ){
            this.num[index] = this.num[index] - 1;
            this.recycledNum[index] = this.recycledNum[index] + 1;
          }
          this.calcAfterRecycle();
        },

        // å¯¹indexå·æ–¹å—å–æ¶ˆå›æ”¶
        cancelRecycle(index) {
          if (this.recycledNum[index] > 0 ){
            this.num[index] = this.num[index] + 1;
            this.recycledNum[index] = this.recycledNum[index] - 1;
          }
          this.calcAfterRecycle();
        },

        // å›æ”¶æˆ–å–æ¶ˆå›æ”¶åéƒ½ä¼šè°ƒç”¨çš„ä¸€ä¸ªå‡½æ•°
        calcAfterRecycle(){
          // ç®—å‡ºå›æ”¶åŒºä¸­èƒ½å‡‘å‡ºçš„æœ€å¤§9å·æ•°é‡æ–¹æ¡ˆmaxPathArr
          let maxPathArr = this.find9Max(this.recycledNum);
          let max = maxPathArr.length;
          // åˆ¶ä½œthis.recycledComponentsï¼Œç›®çš„æ˜¯å°†å„ä¸ª9å·ç¢ç‰‡çš„å›æ”¶ç»„æˆæ˜¾ç¤ºå‡ºæ¥
          this.recycledComponents = [];
          maxPathArr.forEach(path => {
            path = path.map((i)=>(i+1));
            this.recycledComponents.push(path);
          });
        },

        // æ‰“å¼€ç¼“å­˜çŠ¶æ€çš„å¸®åŠ©å¯¹è¯æ¡†
        changeCacheHelpDialogVisible(param) {
          const dialog = this.$refs.cacheHelpDialog
          dialog.showModal()
          let that = this
          // let canCloseCacheHelpDialog = true
          function dialogClickCallback() {
            // console.log("in dialogClickCallback", that.canCloseCacheHelpDialog);
              if (that.canCloseCacheHelpDialog == false) {
                // console.log('ä¸å…³é—­modalï¼Œå¹¶é‡ç½®çŠ¶æ€é‡');
                that.canCloseCacheHelpDialog = true
              }
              else{
                // console.log('æ­£å¸¸å…³é—­modalï¼Œå¹¶ç§»é™¤ç›‘å¬å™¨');
                dialog.close()
                document.querySelector("#cacheHelpDialog").removeEventListener('click', dialogClickCallback);
                document.querySelector("#cacheHelpDialogDiv").removeEventListener('click', dialogDivClickCallback);
            }
          }
          
          function dialogDivClickCallback(){
            // console.log('ä¸èƒ½å…³é—­modalï¼Œä¸èƒ½ç§»é™¤ç›‘å¬å™¨');
            that.canCloseCacheHelpDialog = false
          }

        
          if(param == false){
            // this.canCloseCacheHelpDialog = true
            dialogClickCallback()
            return
          }
          else{
            document.querySelector("#cacheHelpDialog").addEventListener('click', dialogClickCallback);
            document.querySelector("#cacheHelpDialogDiv").addEventListener('click', dialogDivClickCallback);
          }
        },

        // closeCacheHelpDialog(){
        //   const dialog = this.$refs.cacheHelpDialog
        //   dialog.close()
        //   document.querySelector("#cacheHelpDialog").onclick = null
        //   document.querySelector("#cacheHelpDialogDiv").onclick = null
        //   // document.querySelector("#cacheHelpDialog").removeEventListener('click', dialogClickCallback);
        //   // document.querySelector("#cacheHelpDialogDiv").removeEventListener('click', dialogDivClickCallback);
        // },
        
        // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°localStorage
        saveData(){
          if(this.cache === true) {
            // deep copy
            const data = {...this._.data}
            delete data["res"]
            delete data["selectResult"]
            localStorage.setItem('data', JSON.stringify(data))
          }
        },

        // æ”¹å˜ç¼“å­˜çŠ¶æ€
        changeCacheState(param) {
          if (param === true) {
            this.cache = true
            this.saveData()
          }
          else if(param === false){
            let result = window.confirm("è¿™ä¼šæ¸…ç©ºæœ¬åœ°ç¼“å­˜çš„æ•°æ®ï¼ˆå½“å‰é¡µé¢ä¸Šçš„å†…å®¹æŒ‰ä¸‹ç¡®è®¤åä¸ä¼šä¸¢å¤±ï¼‰ï¼Œè¯·ç¡®è®¤")
            if (result){
              this.cache = false
              localStorage.removeItem('data')
            }
          }
        },

        // æŒ‰ç…§å½“å‰æ–¹æ¡ˆæ‰£é™¤å¯¹åº”æ–¹å—
        decreaseBlock() {
          // arr[index] ä»£è¡¨ç¬¬indexå·æ–¹å—å çš„æ ¼å­æ•°ï¼Œè¿™ä¸ªæ˜¯å›ºå®šå€¼
          arr = [4,4,4,4,4,4,4,5,1,2,3]
          // arr_num[index] ä»£è¡¨å½“å‰æ–¹æ¡ˆä¸‹ï¼Œç¬¬indexå·æ–¹å—çš„æ‰€å çš„æ ¼å­çš„ä¸ªæ•°
          arr_num = new Array(11).fill(0)
          // å¾—å‡ºæ¯ä¸ªæ–¹å—çš„ä¸ªæ•°
          for (let index = 0; index < this.sol.length; index++) {
            const element = this.sol[index];
            for (let j = 0; j < element.length; j++) {
              const value = element[j];
              arr_num[value-1]++;
            }
          }
          // sol_num[index] ä»£è¡¨å½“å‰æ–¹æ¡ˆä¸‹ï¼Œç¬¬indexå·æ–¹å—çš„ä¸ªæ•°
          sol_num = new Array(11).fill(0)
          for (let index = 0; index < arr_num.length; index++) {
            sol_num[index] = arr_num[index]/arr[index]
          }
          
          // console.log(sol_num);
          
          // ç”±äºç»“æœç®—å‡ºæ¥ä¹‹åï¼ŒnumåŒºåŸŸä»ç„¶æ˜¯å¯ç¼–è¾‘çš„
          // ç”¨æˆ·å¯èƒ½åœ¨æ­¤æœŸé—´å¢åŠ æˆ–å‡å°‘äº†æŸä¸ªæ–¹å—çš„æ•°é‡ï¼Œæ‰€ä»¥è¿˜æ˜¯è¦éªŒè¯ä¸€ä¸‹èƒ½ä¸èƒ½æŒ‰ç…§æ­¤æ–¹æ¡ˆæ‰£é™¤
          flag = true
          for (let index = 0; index < sol_num.length; index++) {
            const sol_one_num = sol_num[index];
            let my_one_num = this.num[index];
            if (index+1 === 9) {
              // ç‰¹æ®Šå¤„ç†9å·æ–¹å—
              my_one_num = my_one_num + this.recycledComponents.length
            }
            if (my_one_num < sol_one_num) {
              alert(`ç›®å‰çš„æ–¹å— ${index+1} ä¸ªæ•°ä¸º ${my_one_num}ï¼Œå°äºæ­¤æ–¹æ¡ˆè¦æ±‚çš„ ${sol_one_num} ä¸ªï¼Œæ— æ³•æ‰§è¡Œæ‰£é™¤`)
              flag = false
              break
            }
          }
          if (!flag) {
            return
          }

          // å½“å‰çš„sol_numæ•°ç»„å¤‡ä»½åˆ°solBackupé‡Œé¢
          this.solBackup = [].concat(sol_num)
          // this.numBackup = [].concat(this.num)

          // éå†sol_numï¼Œå¾—åˆ°å½“å‰æ–¹æ¡ˆä¸‹ï¼Œæ¯ä¸ªæ–¹å—çš„æ•°é‡ï¼Œå¹¶å¯¹numæ•°ç»„æ‰§è¡Œå‡å»æ“ä½œ
          for (let index = 0; index < sol_num.length; index++) {
            let one_num = sol_num[index]
            // console.log(index+1, one_num);
            if (this.num[index] > 0) {
              if (index+1 === 9 && this.num[index] < one_num) {
                // å¦‚æœæ˜¯9å·æ–¹å—ï¼Œè€Œä¸”è‡ªå·±çš„9å·å°‘äºéœ€è¦çš„9å·
                // è¯´æ˜è‡ªå·±å¡«å…¥çš„9å·æ•°é‡ä¸å¤Ÿï¼Œä¸ºäº†ä¸è¢«å‡æ³•å‡ä¸ºè´Ÿæ•°ï¼Œç›´æ¥èµ‹0
                this.num[index] = 0

                // ä¹Ÿè¯´æ˜æ­¤æ—¶éœ€è¦å¤‡ä»½ recycledComponents å›æ”¶æ–¹æ¡ˆæ•°ç»„
                // å½“å‰çš„recycledComponentsæ•°ç»„å¤‡ä»½åˆ°recycledComponentsBackupé‡Œé¢
                this.recycledComponentsBackup = [].concat(this.recycledComponents)
                
                // æŒ‰ç…§recycledComponentsæ•°ç»„ï¼Œæ‰£é™¤å›æ”¶åŒºrecycledNumé‡Œçš„å†…å®¹
                for (let index = 0; index < this.recycledComponents.length; index++) {
                  const component_arr = this.recycledComponents[index];
                  // console.log(element);
                  for (let j = 0; j < component_arr.length; j++) {
                    let component_index = component_arr[j];
                    // æ•°ç»„é‡Œé¢è¯»å‡ºæ¥çš„indexæ˜¯ç”¨äºæ˜¾ç¤ºçš„ï¼Œå·²ç»åŠ è¿‡1äº†ï¼Œæ­¤å¤„è¦å‡1å†ç”¨
                    component_index--;
                    if (this.recycledNum[component_index] > 0) {
                      this.recycledNum[component_index]--
                    }
                  }
                }

                this.recycledComponents = []
              }
              else{
                this.num[index] = this.num[index] - one_num
                this.recycledComponentsBackup = []
              }
            }
          }

          this.$refs.decreaseBtn.disabled = true
          this.$refs.resetDecreaseBtn.disabled = false
        },

        // æ’¤é”€æ­¤æ¬¡æ–¹å—æ‰£é™¤
        resetBlock(){
          // æ ¹æ®solBackupæ¢å¤numï¼Œç”¨æˆ·è¾“å…¥åŒº
          for (let index = 0; index < this.num.length; index++) {
            if (index+1 === 9 && this.recycledComponentsBackup.length > 0) {
              // å¦‚æœæ˜¯9å·æ–¹å—ï¼Œè€Œä¸”çš„å¤‡ä»½å›æ”¶æ–¹æ¡ˆæ•°ç»„å¤§äº0
              // è¯´æ˜ä¹‹å‰ç”¨æˆ·å¡«å…¥çš„9å·æ•°é‡æ˜¯ä¸å¤Ÿçš„ï¼Œä¸èƒ½ç®€å•ç²—æš´ç›´æ¥æŠŠç»“æœéœ€è¦çš„9å·æ•°é‡éƒ½åŠ å›åˆ°numä¸Šé¢
              // è€Œæ˜¯å…ˆç®—å‡ºç”¨æˆ·ä¹‹å‰å¡«å…¥çš„9å·æ•°é‡ï¼Œè¿™ä¸ªæ•°é‡ = ç»“æœä¸­éœ€è¦çš„9å·æ•°é‡ - å›æ”¶å¾—åˆ°çš„9å·æ•°é‡
              const user9Num = this.solBackup[index] - this.recycledComponentsBackup.length
              // ä¹‹åæŠŠç”¨æˆ·å¡«å…¥çš„9å·æ•°é‡åŠ å›åˆ°numæ•°ç»„ä¸Š
              this.num[index] = this.num[index] + user9Num

              // ä¹Ÿè¯´æ˜æ­¤æ—¶éœ€è¦æ¢å¤ recycledComponents å›æ”¶æ–¹æ¡ˆæ•°ç»„å’Œ recycledNum å›æ”¶åŒº
              // æ ¹æ®this.recycledComponentsBackupæ¢å¤å›æ”¶æ–¹æ¡ˆæ•°ç»„recycledComponents
              for (let index = 0; index < this.recycledComponentsBackup.length; index++) {
                const component_arr = this.recycledComponentsBackup[index] 
                this.recycledComponents.push(component_arr)
              }
              // æ ¹æ®this.recycledComponentsBackupæ¢å¤å›æ”¶åŒºrecycledNum
              for (let index = 0; index < this.recycledComponentsBackup.length; index++) {
                const component_arr = this.recycledComponentsBackup[index];
                // console.log(element);
                for (let j = 0; j < component_arr.length; j++) {
                  let component_index = component_arr[j];
                  component_index--;
                  this.recycledNum[component_index]++
                  
                }
              }
           
            }
            else{
              this.num[index] = this.num[index] + this.solBackup[index]
            }
          }


          this.$refs.decreaseBtn.disabled = false
          this.$refs.resetDecreaseBtn.disabled = true
        }
      },
      computed: {
        sol() {
          return this.selectResult[this.now]
        }
      },
      mounted(){
        console.log('on mounted');
        // è¯»å–æœ¬åœ°æ•°æ®ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å­˜å‚¨çš„æ•°æ®ï¼Œå¦‚æœæœ‰ï¼Œåˆ™æ¢å¤
        let storeData = JSON.parse(localStorage.getItem('data'))
        console.log('read', storeData);
        if (storeData!=null && storeData.cache === true) {
          let vueData = this._.data
          // console.log(vueData)
          for (const key in vueData) {
            if (Object.hasOwnProperty.call(vueData, key)) {
              const value = vueData[key];
              // console.log(key, value);
              if (Object.hasOwnProperty.call(storeData, key)) {
                this[key] = storeData[key]
              }
            }
          }
        }

        // å¯¹recycledNumå›æ”¶åŒºå¯åŠ¨ç›‘å¬ï¼Œå¦‚æœå›æ”¶åŒºé‡Œé¢éƒ½æ˜¯0ï¼Œä½¿å¾—â€œæ’¤é”€æ‰€æœ‰å›æ”¶â€æŒ‰é’®å˜ä¸ºç°è‰²
        this.$watch('recycledNum', (newVal, oldVal) => {
          this.$refs.resetRecycleBtn.disabled = true
          for (let index = 0; index < newVal.length; index++) {
            const element = newVal[index];
            if (element > 0) {
              this.$refs.resetRecycleBtn.disabled = false 
              break
            }
          }
        }, {deep:true})
        
        // ç›‘å¬é¡µé¢çš„å¯è§æ€§å˜åŒ–å’Œåˆ·æ–°äº‹ä»¶ï¼Œå‘ç”Ÿè¿™äº›äº‹ä»¶åˆ™åŠæ—¶ä¿å­˜æ•°æ®è‡³æœ¬åœ°
        document.addEventListener('visibilitychange', () => {
          this.saveData()
        })
        window.addEventListener('beforeunload', () => {
          this.saveData()
        })
      },
      beforeunmounted(){
        // this.saveData()
      },
    }).mount('#app')
  </script>
  <style>
    p {
      margin: 4px 0;
    }
    .box {
      display: inline-block;
      box-sizing: border-box;
      width: 32px;
      height: 32px;
      border: 1px black solid;
      cursor: pointer;
    }
  </style>
</body>

</html>