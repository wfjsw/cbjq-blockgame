<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å°˜ç™½ç¦åŒºä¿¡æºç ”æ</title>
  <script src="https://cdn.bootcdn.net/ajax/libs/vue/3.2.47/vue.global.prod.min.js"></script>
  <script src="./calc.js"></script>
</head>

<body>
  åŸä½œè€…ï¼š<a href="https://space.bilibili.com/277401945" target="_blank">Bilibili æ–¹å½¢çš„å—çŠ¶ä»£ç </a>
  <div id="app">
    <p>è¡Œæ•°ï¼š<input type="text" v-model="row" /></p>
    <p>åˆ—æ•°ï¼š<input type="text" v-model="col" /></p>
    <input type="button" value="ç¡®å®š" @click="confirmBoard">
    <p>çº¢è‰²è¡¨ç¤ºéœ€è¦æ‘†æ”¾çš„æ ¼å­ï¼Œç™½è‰²è¡¨ç¤ºè¿™é‡Œæ²¡æœ‰æ ¼å­ï¼Œç‚¹å‡»åˆ‡æ¢</p>
    <div v-for="(r, i) in board" style="height: 32px;">
      <div
        class="box"
        v-for="(c, j) in r"
        @click="tuneBox(i, j)"
        :style="{ 'background-color': c === 0 ? 'white' : 'red' }"
      ></div>
    </div>
    <div v-if="board.length" style="margin-top: 0px;">
        <div style="width:fit-content;">
          <table>
            <tr>
              <th></th>
              <th>
                <div style="margin-left: 0px;">
                  å¿…é€‰
                </div>
              </th>
              <th>
                <div style="margin-left: 0px;">
                  å›æ”¶
                </div>
              </th>
              <th>
                <div style="margin-left: 0px;">
                  å›æ”¶ä¸ªæ•°
                </div>
              </th>
              <th>
                <div style="margin-left: 0px;">
                  å–æ¶ˆå›æ”¶
                </div>
              </th>
            </tr>
            <tr v-for="(b, i) in num">
              <td>
                æ–¹å—{{ i + 1 }}ä¸ªæ•°ï¼š
                <div v-if="i+1 === 9" style="display: inline-block;">
                  {{ num[i] + recycledComponents.length}} = 
                      <input style="width: 100px;"  type="text" v-model.number="num[i]" />
                      + {{ recycledComponents.length }}
                </div>
                <div v-else style="display: inline-block;">
                  
                      <input type="text" v-model.number="num[i]" />
  

                </div>
              </td>
              <td style=" zoom: 100%; vertical-align: middle; margin-top: 80px; text-align: center;">
                <input type="checkbox" 
                  style="text-align: left; vertical-align: middle; margin-top: 5px;"
                  v-model="selected[i]" 
                  :title="'ä¿¡æº ' + (i+1) + ' å¿…é€‰'"
                  @click="select(i)"/>
              </td>
              <td>
                <Button type="" @click="recycle(i)">ğŸ—‘ï¸</Button>
              </td>
              <td style="vertical-align: middle; text-align: center;">
                {{ recycledNum[i] }}
              </td>
              <td style="text-align: center;">
                <Button type="" @click="cancelRecycle(i)">ğŸ—‘ï¸-1</Button>
              </td>
            </tr>
          </table>
          
          <div 
          style="margin-top: 5px; 
          margin-bottom: 5px; 
          margin-right: 10px; 
          border: dashed 2px; 
          border-radius: 10px; 
          padding: 5px;
          ">
            <div style="font-size: medium;">
              æ–¹å—9ä¸ªæ•°=ç”¨æˆ·è¾“å…¥ {{ num[8] }} + å›æ”¶å¾—åˆ° {{ recycledComponents.length }} <br>
            </div>
            <div style="margin-top: 7px; margin-bottom: 5px;">
              å›æ”¶çš„æ–¹å—9æ„æˆï¼š
            </div>
            <div v-for="(v, i) in recycledComponents">
              <div style="display:inline-block;" v-for="(v2, j) in recycledComponents[i]">
                æ–¹å— {{v2}},&nbsp; 
              </div>
              <br>
              <hr />
            </div>
          </div>

          <div
          style="margin-top: 5px; 
          margin-bottom: 5px; 
          margin-right: 10px; 
          border: dashed 2px; 
          border-radius: 10px; 
          padding: 5px;
          ">
            <p>ã€2023-09-24æ³¨ã€‘ç›®å‰å¯¹äºæ–¹å— 10 å’Œ 11 çš„æ”¯æŒä»…ç»è¿‡äº†ç®€å•æµ‹è¯•</p>
            <p>å¦‚æœé‡åˆ°å…³äºæ–¹å— 10 å’Œ 11 çš„ bug å¯ä»¥å¸¦ä¸Šå‡ºé”™çš„æƒ…å†µç»™æˆ‘çš„ <a href="https://github.com/halozhy/cbjq">GitHub åˆ†æ”¯ä»“åº“</a> æ Issue</p>
            <p>ï¼ˆæˆ–è€…åœ¨ <a href="https://www.bilibili.com/video/BV1hp4y1j75k/">BV1hp4y1j75k</a> è¿™ä¸ªè§†é¢‘ä¸‹é¢è¯„è®ºåŒºå¸¦ä¸Šå‡ºé”™çš„æƒ…å†µç•™è¨€ï¼‰</p>
          </div>
         
          <div>
            <input type="button" value="è®¡ç®—å®Œç¾æ–¹æ¡ˆ" @click="calc">
            <input type="button" style="margin-left: 10px;" value="ä¸€é”®å›æ”¶å¹¶è®¡ç®—" @click="calcFull">
            <input type="button" style="margin-right: 10px; float: right;" value="æ’¤é”€æ‰€æœ‰å›æ”¶" @click="resetRecycle">
          </div>
        </div>

      
    </div>
    <div v-if="res !== false">
      <p>æ–¹æ¡ˆæ•°ï¼š{{ res.length }}</p>
      <p>æ–¹æ¡ˆæ•°(filterd)ï¼š{{ selectResult.length }}/{{ res.length }}</p>
    </div>
    <div v-if="res.length">
      <p>å½“å‰å±•ç¤ºæ–¹æ¡ˆï¼š{{ now + 1 }} / {{ res.length }}</p>
      <p>å½“å‰å±•ç¤ºæ–¹æ¡ˆ(filterd)ï¼š{{ now + 1 }} / {{ selectResult.length }}</p>
      <input type="button" value="<-" @click="now -= (now > 0)">
      <input type="button" value="->" @click="now += (now + 1 < selectResult.length)">
      <div v-for="(r, i) in sol" style="height: 32px;">
        <div
          class="box"
          v-for="(c, j) in r"
          :style="{ 'background-color': color[c] }"
        >{{ c }}</div>
      </div>
    </div>
  </div>
  <script>
    const { createApp } = Vue
    createApp({
      data() {
        return {
          row: 5,
          col: 6,
          board: [],
          num: new Array(11).fill(0),
          // num: [1,1,1,2,2,2,2,1,0],
          // num: [6,1,1,2,2,2,2,1,0], 
          // num: [2,2,2,2,2,0,0,0,0], 
          recycledNum: new Array(11).fill(0),
          recycledComponents: new Array(0),
          selected: new Array(11).fill(false),
          res: false,
          selectResult: false,
          now: 0,
          color: ['white', '#75C0FF', '#3B66CF', '#78ACC5', '#C8FAFD', '#FDFF00', '#4BFF00', '#FF9800', '#B9B24B', '#FF00AE', '#FF00EE', '#acb7d5']
        }
      },
      methods: {
        confirmBoard() {
          const row = Number(this.row)
          const col = Number(this.col)
          this.board = new Array(row)
          for (let i = 0; i < row; ++i) {
            const r = new Array(col).fill(-1)
            this.board[i] = r
          }
        },
        tuneBox(x, y) {
          if (this.board[x][y] === -1) {
            this.board[x][y] = 0
          } else {
            this.board[x][y] = -1
          }
        },
        calc() {
          let num = Object.assign([], this.num)
          num[8] = this.num[8] + this.recycledComponents.length
          this.res = Solve(this.board, num)
          this.now = 0
          this.filter();
        },
        filter(requiredInfoIds) {
          // console.log('in filter');
          if(!this.res){
            return;
          }

          if(!requiredInfoIds){
            requiredInfoIds = this.selected.map((v,i)=>v?i+1:-1).filter(v => v !== -1);
          } 
          // console.log("filter array:",requiredInfoIds);
          if(requiredInfoIds.length == 0){
            this.selectResult = this.res;
            return;
          }
          this.selectResult = this.res.filter(function(result){
            let temp = [].concat(...result);
            let cnt = 0;
            for(let i=0;i<requiredInfoIds.length;++i){
              if(!temp.includes(requiredInfoIds[i])){
                return false;
              }
            }
            return true;
          });
        },
        select(index) {
          // console.log('select');
          let requiredInfoIds = new Array();
          this.selected.forEach((isSelect, i) => {
            if(isSelect && i!=index || !isSelect && i==index){
              requiredInfoIds.push(i+1);
            }
          });
          this.filter(requiredInfoIds);
        },

        // è¿”å›èƒ½å¤Ÿå›æ”¶åˆ°çš„æœ€å¤šçš„9å·æ–­ç‰‡çš„å›æ”¶æ–¹æ¡ˆ
        find9Max(recycledNum) {
          // å…¶å®å°±æ˜¯æ‰¾å‡ºæ‰€æœ‰çš„å›æ”¶æ–¹æ¡ˆï¼Œä¹‹åä»é‡Œé¢æ‰¾ä¸€ä¸ªæœ€é•¿çš„
          let allPathArr = this.find9All(recycledNum);
          let max = 0
          let maxPathArr = [];
          allPathArr.forEach(onePath => {
            if (onePath.length > max) {
              max = onePath.length;
              maxPathArr = onePath;
            }
          });
          return maxPathArr; 
        },

        // è¿”å›æ‰€æœ‰9å·æ–­ç‰‡çš„å›æ”¶æ–¹æ¡ˆ
        find9All(recycledNum) {
          let num = Object.assign([], recycledNum);
          let allPathArr = [];

          // è®¡ç®—ç»„åˆæ•° C(9,5) ç»“æœåº”è¯¥æ˜¯å›ºå®šçš„126ç§å¯èƒ½
          let chooseResult = choose(Array.from({length:9}, (v,k) => k), 5);
          // https://juejin.cn/post/6959102042279247909
          function choose(arr, size) {
            var allResult = [];
            (function (arr, size, result) {
                var arrLen = arr.length;
                if (size > arrLen) {
                    return;
                }
                if (size == arrLen) {
                    allResult.push([].concat(result, arr))
                } else {
                    for (var i = 0; i < arrLen; i++) {
                        var newResult = [].concat(result);
                        newResult.push(arr[i]);

                        if (size == 1) {
                            allResult.push(newResult);
                        } else {
                            var newArr = [].concat(arr);
                            newArr.splice(0, i + 1);
                            arguments.callee(newArr, size - 1, newResult);
                        }
                    }
                }
            })(arr, size, []);
            return allResult;
          }
          
          // é€’å½’æŸ¥æ‰¾  
          recursionFind(num, [], 0);

          /**
           * è¿›è¡Œé€’å½’å‡‘æ•°æŸ¥æ‰¾9å·ç¢ç‰‡çš„å‡½æ•°
           * @param {*} nowRecycleNum å¯å›æ”¶çš„numæ•°ç»„
           * @param {*} pathArr è®°å½•äº†å›æ”¶ç»“æœçš„æ•°ç»„ï¼Œä¹Ÿç›¸å½“äºæ˜¯é€’å½’è·¯å¾„
           * @param {*} layer é€’å½’å±‚æ•°
           */
          function recursionFind(nowRecycleNum, pathArr, layer) {
            layer++;
            let okResultList = [];
            for (let i = 0; i < chooseResult.length; i++) {
              const result = chooseResult[i];
              // console.log(result);
              let flag = true;
              for (let j = 0; j < result.length; j++) {
                const index = result[j];
                if (nowRecycleNum[index] <= 0 ) {
                  // console.log('å­˜åœ¨0ï¼Œæ— æ³•å›æ”¶');
                  flag = false;
                  break;
                }
              }
              if (flag) {
                // è®°å½•ä¸‹æ¥èƒ½å›æ”¶çš„å¯èƒ½æ€§
                okResultList.push(result);
                // break;
              }
            }
            // console.log('è¿™å±‚çš„æ‰€æœ‰æ–¹æ¡ˆæ•°é‡', layer, okResultList.length);
            if (okResultList.length == 0) {
              // è¿™å±‚å·²ç»æ‰¾ä¸åˆ°æ–¹æ¡ˆäº†ï¼Œå› æ­¤returnç»“æŸæ­¤å±‚é€’å½’
              return;
            }
            else {
              // è¿™å±‚ä»æœ‰æ–¹æ¡ˆï¼Œåˆ™è®°å½•åœ¨allPathArré‡Œé¢
              for (let index = 0; index < okResultList.length; index++) {
                const thisPath = okResultList[index];
                // let newOne = [pathArr , thisPath];
                let newOne = [].concat(pathArr);
                newOne.push(thisPath);
                allPathArr.push(newOne)  
              }
              // console.log(allPathArr);
            }
            // console.log('okResultList', layer, okResultList, pathArr);
            for (let i = 0; i < okResultList.length; i++) {
              const okResult = okResultList[i];
              // æŒ‰ç…§æ–¹æ¡ˆå¯¹nowRecycleNumæ‰§è¡Œåˆ å‡
              let nRN = [].concat(nowRecycleNum);
              okResult.forEach(index => {
                nRN[index]--;
              });
              let pa = JSON.parse(JSON.stringify(pathArr));
              pa.push(okResult)
              recursionFind(nRN, pa, layer);
            }
          }
          
          return allPathArr;
        },

        calcFull() {
          // ä¸€é”®å›æ”¶å¹¶è®¡ç®—
          // å…ˆå°è¯•ä¸å›æ”¶ï¼Œç›´æ¥è®¡ç®—ï¼Œå¦‚æœèƒ½å‡ºç»“æœå°±ä¸è¿›è¡Œå›æ”¶
          // å¦‚æœä¸èƒ½å‡ºç»“æœï¼Œè®¡ç®—å‡ºæ‰€æœ‰çš„9å·å›æ”¶æ–¹æ¡ˆï¼Œä¾æ¬¡å°è¯•ï¼Œç›´åˆ°å‡ºç»“æœä¸ºæ­¢
          // å¦‚æœå‡å°è¯•è¿‡äº†ï¼Œä½†æ²¡ç»“æœï¼Œåˆ™è®¤ä¸ºæ— è§£
         
          // å…ˆå°è¯•ä¸å›æ”¶ï¼Œç›´æ¥è®¡ç®—ï¼Œè‹¥æœ‰ç»“æœï¼Œç›´æ¥returnç»“æŸ
          this.calc();
          if (this.selectResult.length > 0 ) {
            return;
          } 
          else {
            // å¦‚æœä¸èƒ½ç›´æ¥å‡ºç»“æœï¼Œè®¡ç®—å‡ºæ‰€æœ‰çš„9å·å›æ”¶æ–¹æ¡ˆ
            let allPathArr = this.find9All(this.num);
            // ä¾æ¬¡å°è¯•ï¼Œç›´åˆ°calcè®¡ç®—åæœ‰ç»“æœä¸ºæ­¢
            for (let index = 0; index < allPathArr.length; index++) {
              const onePath = allPathArr[index];
              // æŒ‰ç…§è¿™ä¸ªæ–¹æ¡ˆè¿›è¡Œå›æ”¶
              for (let j = 0; j < onePath.length; j++) {
                const one9 = onePath[j];
                one9.forEach(index => {
                  // æ‰§è¡Œnum--å’Œrecycle++
                  this.num[index]--;
                  this.recycledNum[index]++;
                });
                // å¯¹ç•Œé¢ä¸Šçš„å›æ”¶åŒºè¿›è¡Œæ›´æ–°
                let one9ForView = one9.map((i)=>(i+1));
                this.recycledComponents.push(one9ForView);
              }
              
              // æ‰§è¡Œcalcè®¡ç®—ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ç»“æœ
              this.calc();
              if (this.selectResult.length > 0 ) {
                // æœ‰ç»“æœäº†ï¼Œreturnç»“æŸ
                return;
              } 
              else {
                // æ— ç»“æœï¼Œæ¢å¤numï¼ŒrecycleNumï¼ŒrecycledComponents
                for (let j = 0; j < onePath.length; j++) {
                  const one9 = onePath[j];
                  one9.forEach(index => {
                    // æ‰§è¡Œnum++å’Œrecycle--
                    this.num[index]++;
                    this.recycledNum[index]--;
                  });
                }
                this.recycledComponents = [];
              }
            }
          }
        },
        resetRecycle() {
          for (let index = 0; index < this.recycledNum.length; index++) {
            const value = this.recycledNum[index];
            while (this.recycledNum[index] > 0 ){
              this.cancelRecycle(index)
            }
          }
          this.calc()
        },
        recycle(index) {
          if (this.num[index] > 0 ){
            this.num[index] = this.num[index] - 1;
            this.recycledNum[index] = this.recycledNum[index] + 1;
          }
          this.calcAfterRecycle();
        },
        cancelRecycle(index) {
          if (this.recycledNum[index] > 0 ){
            this.num[index] = this.num[index] + 1;
            this.recycledNum[index] = this.recycledNum[index] - 1;
          }
          this.calcAfterRecycle();
        },
        calcAfterRecycle(){
          // ç®—å‡ºå›æ”¶åŒºä¸­èƒ½å‡‘å‡ºçš„æœ€å¤§9å·æ•°é‡æ–¹æ¡ˆmaxPathArr
          let maxPathArr = this.find9Max(this.recycledNum);
          let max = maxPathArr.length;
          // åˆ¶ä½œthis.recycledComponentsï¼Œç›®çš„æ˜¯å°†å„ä¸ª9å·ç¢ç‰‡çš„å›æ”¶ç»„æˆæ˜¾ç¤ºå‡ºæ¥
          this.recycledComponents = [];
          maxPathArr.forEach(path => {
            path = path.map((i)=>(i+1));
            this.recycledComponents.push(path);
          });
        },
        
      },
      computed: {
        sol() {
          return this.selectResult[this.now]
        }
      }
    }).mount('#app')
  </script>
  <style>
    p {
      margin: 4px 0;
    }
    .box {
      display: inline-block;
      box-sizing: border-box;
      width: 32px;
      height: 32px;
      border: 1px black solid;
      cursor: pointer;
    }
  </style>
</body>

</html>